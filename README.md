# 🚇 대구도시철도 2호선 도착 기반 자동문 제어 시스템

**Daegu Metro Line 2 Arrival-based Automatic Door System (C++ & Raspberry Pi)**

이 프로젝트는 대구도시철도 2호선 열차 도착 정보를 실시간으로 조회하고,  
이를 바탕으로 라즈베리파이 기반 자동문(초음파 센서 + 서보모터)을 제어하는 임베디드 시스템입니다.

열차가 특정 역(두류역)에 곧 도착하면 자동문이 열리지만,  
문 앞에 사람이 있을 경우 안전을 위해 문이 열리지 않도록 설계되어 있습니다.

---

## 📌 주요 기능

### ✔ 1. 실시간 열차 도착 정보 조회 (C++ & libcurl)
- 공공데이터포털 OpenAPI 활용
- 상행(영남대 → 문양) 시각표 정보 자동 요청
- libcurl로 JSON 데이터 수신
- 기능 요약:
  - 현재 요일 기반 평일/토요일/공휴일 자동 분류
  - 이미 지나간 열차 제외
  - 다음 열차들의 “몇 분 후 도착” 자동 계산

### ✔ 2. 자동문 제어 시스템 (Raspberry Pi + 초음파 센서 + 서보)
- 라즈베리파이는 C++ 프로그램이 계산한 열차 ETA 정보를 2초마다 확인
- 초음파 센서(HC-SR04)로 문 앞의 사람 유무 측정
- 구성 요소:
  - Raspberry Pi
  - 초음파 센서 HC-SR04 (거리 감지)
  - 서보모터 SG90/MG90S (문 개폐 구동)
  - 2초 주기 갱신 타이머
  - 안전 디바운싱 및 서보 과부하 방지 로직

### ✔ 3. 센서 기반 안전 기능
- 문 앞 거리 ≤ 30cm → “사람 있음”으로 판단
- 사람이 있을 때는 열차가 도착해도 문 열리지 않음
- 서보 과부하를 막기 위해 최소 동작 간격 유지
- 모든 상태변화는 2초 주기로 갱신

### ✔ 4. 상행(상선) 기준 계산
현재 OpenAPI는 **2호선 상행(영남대 → 문양)** 시간표만 제공함.  
따라서 본 프로그램은 **두류역에 문양 방향으로 들어오는 열차**의 도착 정보를 보여줍니다.

---

## 🚀 전체 동작 흐름 (Integrated System Flow)
1. C++ 프로그램 실행 → API 요청 → 열차 ETA 계산
2. ETA 정보를 Raspberry Pi가 확인 가능한 파일에 저장
3. Raspberry Pi Python 스크립트가 2초마다:
   - ETA 확인
   - 초음파 센서 거리 측정
4. 조건 만족 시:
   - 서보모터 각도 변경 → 문 열림
5. 사람 감지 또는 ETA 조건 미충족 시:
   - 문 닫힘 유지

---

